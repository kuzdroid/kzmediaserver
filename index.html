<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>KZMedia + KZAsistan</title>
<style>
  body{margin:0;font-family:system-ui,Segoe UI,Roboto,Arial;background:#0b0c10;color:#e8eaed}
  .header{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;background:#11131a;border-bottom:1px solid #212532}
  .container{max-width:1000px;margin:18px auto;padding:0 16px;display:grid;grid-template-columns:1fr 320px;gap:12px}
  .card{background:#11131a;border:1px solid #212532;border-radius:12px;padding:12px}
  input,textarea{width:100%;padding:8px;border-radius:8px;border:1px solid #212532;background:#0e1016;color:#e8eaed}
  button{padding:8px 10px;border-radius:8px;border:none;cursor:pointer;background:#4f8cff;color:#fff}
  .small{font-size:12px;color:#a3a7b0}
  .post{margin-top:10px;padding:10px;border:1px solid #212532;border-radius:10px}
  .row{display:flex;gap:8px;align-items:center;margin-top:6px}
  #progress{width:100%;background:#222;border-radius:6px;overflow:hidden;height:8px;margin-top:8px}
  #progressBar{height:100%;background:#4f8cff;width:0%}
</style>
</head>
<body>
<header class="header">
  <strong>KZMedia</strong>
  <span class="small">‚Ä¢ sosyal + KZAsistan</span>
</header>

<main class="container">
  <!-- Sol: Sosyal Akƒ±≈ü -->
  <section class="card">
    <h3>G√∂nderiler</h3>
    <textarea id="postText" rows="3" placeholder="Ne payla≈ümak istersin?"></textarea>
    <div class="row">
      <button id="btnPost">Payla≈ü</button>
      <button id="btnRefresh">Yenile</button>
    </div>
    <div id="feed"></div>
    <div class="small" id="empty" style="display:none">G√∂nderi yok</div>
  </section>

  <!-- Saƒü: KZAsistan -->
  <aside class="card">
    <h4>KZAsistan</h4>
    <div id="progress"><div id="progressBar"></div></div>
    <div class="row">
      <input id="ask" placeholder="Soru yaz...">
      <button id="btnAsk">Sor</button>
    </div>
    <div id="ans" class="small" style="margin-top:8px"></div>
  </aside>
</main>

<!-- WebLLM -->
<script src="https://cdn.jsdelivr.net/npm/@mlc-ai/web-llm@0.2.42/dist/index.min.js"></script>
<script>
  const $ = id => document.getElementById(id);
  const API = "";

  // --- Sosyal kƒ±sƒ±m ---
  async function loadFeed(){
    const r=await fetch(API+'/api/posts'); 
    const arr=await r.json();
    const feed=$("feed"); feed.innerHTML=""; let shown=0;
    for(const p of arr){
      const div=document.createElement("div"); div.className="post";
      div.innerHTML=`<div><b>${p.author||"Anonim"}</b> 
        <span class="small">${new Date(p.createdAt).toLocaleString()}</span></div>
        <div>${p.text||""}</div>`;
      feed.appendChild(div); shown++;
    }
    $("empty").style.display = shown?"none":"block";
  }
  $("btnPost").onclick=async()=>{
    const text=$("postText").value.trim(); 
    if(!text) return alert("Bo≈ü olamaz");
    await fetch(API+'/api/posts',{method:"POST",
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({author:"Anonim",text})});
    $("postText").value=""; loadFeed();
  };
  $("btnRefresh").onclick=loadFeed; 
  loadFeed();

  // --- KZAsistan (Llama-2-7B) ---
  let engine=null;
  async function loadModel(){
    $("ans").textContent="‚è≥ Llama y√ºkleniyor...";
    engine=await webllm.CreateMLCEngine("Llama-2-7b-chat-hf-q4f16_1",{
      initProgressCallback:(p)=>{
        const pct=Math.round((p?.progress||0)*100);
        $("progressBar").style.width=pct+"%";
        $("ans").textContent="üì• Y√ºkleniyor: "+pct+"%";
      }
    });
    $("ans").textContent="‚úÖ Llama hazƒ±r";
  }
  loadModel();

  $("btnAsk").onclick=async()=>{
    const q=$("ask").value.trim(); if(!q) return;
    if(!engine) return alert("Model y√ºklenmedi");
    $("ans").textContent="‚úçÔ∏è d√º≈ü√ºn√ºyor...";
    const reply=await engine.chat.completion([{role:"user",content:q}]);
    $("ans").textContent=reply.choices[0].message.content;
  };
</script>
</body>
</html>
