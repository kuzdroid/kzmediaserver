<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>KZMedia</title>
<style>
  body{margin:0;font-family:system-ui,Segoe UI,Roboto,Arial;background:#0b0c10;color:#e8eaed}
  .header{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;background:#11131a;border-bottom:1px solid #212532}
  .container{max-width:1000px;margin:18px auto;padding:0 16px;display:grid;grid-template-columns:1fr 320px;gap:12px}
  .card{background:#11131a;border:1px solid #212532;border-radius:12px;padding:12px}
  input,textarea{width:100%;padding:8px;border-radius:8px;border:1px solid #212532;background:#0e1016;color:#e8eaed;outline:none}
  button{padding:8px 10px;border-radius:8px;border:none;cursor:pointer;background:#4f8cff;color:#fff}
  .small{font-size:12px;color:#a3a7b0}
  .post{margin-top:10px;padding:10px;border:1px solid #212532;border-radius:10px}
  .row{display:flex;gap:8px;align-items:center;margin-top:6px}
  .progress{width:100%;height:6px;background:#222;border-radius:6px;margin-top:8px}
  .bar{height:100%;width:0;background:#4f8cff;border-radius:6px;transition:width .3s}
</style>
</head>
<body>
<header class="header">
  <strong>KZMedia</strong>
  <span class="small">• sosyal + asistan</span>
</header>

<main class="container">
  <section class="card">
    <h3>Giriş / Kayıt</h3>
    <div class="row">
      <input id="txtUser" placeholder="kullanıcı adı (ör: kursatomer@KUZİLER)">
      <input id="txtPass" placeholder="şifre" type="password">
      <button id="btnRegister">Kayıt</button>
      <button id="btnLogin">Giriş</button>
    </div>
    <hr>
    <div id="compose" style="display:none">
      <h3>Paylaş</h3>
      <textarea id="postText" rows="3" placeholder="Ne paylaşmak istersin?"></textarea>
      <input id="postImage" placeholder="Resim URL (opsiyonel)">
      <input id="postVideo" placeholder="Video URL (opsiyonel)">
      <label class="row"><input id="postPrivate" type="checkbox"><span class="small">@KUZILER</span></label>
      <div class="row">
        <button id="btnPost">Paylaş</button>
        <button id="btnRefresh">Yenile</button>
      </div>
    </div>
    <hr>
    <h3>Akış</h3>
    <div id="feed"></div>
    <div class="small" id="empty" style="display:none">Gönderi yok</div>
  </section>

  <aside class="card">
    <div class="small">Şu anki kullanıcı: <strong id="meName">—</strong></div>
    <hr>
    <h4>KZAsistan</h4>
    <div class="row">
      <input id="ask" placeholder="Soru yaz (ör: merhaba)">
      <button id="btnAsk">Sor</button>
    </div>
    <div id="ans" class="small" style="margin-top:8px"></div>
    <div class="row" style="margin-top:8px">
      <button id="btnAsistanPost">Asistan Akışa Yazsın</button>
    </div>
    <div class="progress"><div class="bar" id="progressBar"></div></div>
  </aside>
</main>

<!-- Asistan scriptleri -->
<script src="https://unpkg.com/@mlc-ai/web-llm/dist/index.min.js"></script>
<script>
  // mlc tanımlı değilse webllm'yi ata
  window.mlc = window.mlc || window.webllm;
</script>

<script>
  const API = ""; // aynı origin
  const $ = id => document.getElementById(id);
  function esc(s=""){ return String(s).replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

  // Kayıt
  $('btnRegister').addEventListener('click', async ()=>{
    const u=$('txtUser').value.trim(); const p=$('txtPass').value;
    if(!u||!p) return alert('Kullanıcı adı ve şifre boş olamaz');
    const r=await fetch(API+'/api/auth/register',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username:u,password:p})});
    const j=await r.json();
    if(!r.ok) return alert(j.error||'Kayıt başarısız');
    alert('Kayıt tamam. Lütfen giriş yapın.');
  });

  // Giriş
  $('btnLogin').addEventListener('click', async ()=>{
    const u=$('txtUser').value.trim(); const p=$('txtPass').value;
    if(!u||!p) return alert('Kullanıcı adı ve şifre boş olamaz');
    const r=await fetch(API+'/api/auth/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username:u,password:p})});
    const j=await r.json();
    if(!r.ok) return alert(j.error||'Giriş başarısız');
    $('meName').textContent = j.user?.username || u;
    $('compose').style.display = 'block';
    await loadFeed();
  });

  // Akış yükle
  async function loadFeed(){
    const feed=$('feed'); feed.innerHTML='';
    const r=await fetch(API+'/api/posts/feed'); const arr=await r.json();
    if(!r.ok) return alert('Akış hatası');
    if(!arr.length) $('empty').style.display='block'; else $('empty').style.display='none';
    for(const p of arr){
      const div=document.createElement('div'); div.className='post';
      div.innerHTML=`<div><strong>${esc(p.author||'-')}</strong></div><div>${esc(p.text||'')}</div>`;
      feed.appendChild(div);
    }
  }

  // Asistan (örnek simülasyon)
  $('btnAsk').addEventListener('click', async ()=>{
    const q=$('ask').value.trim();
    if(!q) return;
    $('ans').textContent="KZAsistan düşünüyor...";
    // Burada mlc veya webllm kullanılacak
    setTimeout(()=>{
      $('ans').textContent="(Yanıt) "+q+" hakkında basit bir cevap.";
    },1500);
  });

  $('btnAsistanPost').addEventListener('click', ()=>{
    const ans=$('ans').textContent.trim();
    if(!ans) return alert("Önce asistanla konuşun.");
    const div=document.createElement('div'); div.className='post';
    div.innerHTML=`<div><strong>KZAsistan</strong></div><div>${esc(ans)}</div>`;
    $('feed').prepend(div);
  });
</script>
</body>
</html>
